<!doctype html>
<html>
  <head>
    <title>Mist Train Damage Table</title>
  </head>
  <script>
    var coef = [0.95, 0.96, 0.97, 0.98, 0.99, 1.0, 1.01, 1.02, 1.03, 1.04];
    function is_valid_damage(damage, base_damage){
      for (var i=0; i<coef.length; i++) {
        if (Math.abs(coef[i]*base_damage - damage) < 5){
          return true;
        }
      }
      return false;
    }
    function is_valid_base_damage(damage_list, base_damage){
      for (var i=0; i<damage_list.length; i++){
        if (!is_valid_damage(damage_list[i], base_damage)){
          return false;
        }
      }
      return true;
    }
    function find_base_damage(damage_list){
      var damage_list_sorted = damage_list.sort(function(a,b) { return a - b;});
      for (var i=0; i<coef.length; i++) {
        var base_damage = damage_list_sorted[0]/coef[i];
        if (is_valid_base_damage(damage_list_sorted, base_damage)){
          return base_damage;
        }
      }
      return 0;
    }
    function clear_input() {
      document.getElementById("damage1").value = 0;
      document.getElementById("damage2").value = 0;
      document.getElementById("damage3").value = 0;    
    }
    function modify_table() {
      var tbl = document.getElementById("dmgTable");
      var damage1 = document.getElementById("damage1").value;
      var damage2 = document.getElementById("damage2").value;
      var damage3 = document.getElementById("damage3").value;
      var base_damage = find_base_damage([damage1, damage2, damage3]);
      for (var i=0; i<coef.length; i++) {
        if (base_damage!=0) {
          tbl.rows[i+1].cells[1].innerHTML = Math.round(base_damage*coef[i]);
        }
        else {
          tbl.rows[i+1].cells[1].innerHTML = 'N/A';
        }
      }
    }
  </script>
  <body>
    ダメージ実測値1: <input type="number" id="damage1" value="0"> <br>
    ダメージ実測値2: <input type="number" id="damage2" value="0"> <br>
    ダメージ実測値3: <input type="number" id="damage3" value="0"> <br>
    <input type="button" value="削除" onclick="clear_input();" />
    <input type="button" value="入力" onclick="modify_table();" />
    <h1>ダメージ表</h1>
    <table border=0 id="dmgTable">
      <tr>
        <td>係数</td>
        <td>ダメージ</td>
      </tr>
      <tr>
        <td>0.95</td>
        <td>N/A</td>
      </tr>
      <tr>
        <td>0.96</td>
        <td>N/A</td>
      </tr>
      <tr>
        <td>0.97</td>
        <td>N/A</td>
      </tr>
      <tr>
        <td>0.98</td>
        <td>N/A</td>
      </tr>
      <tr>
        <td>0.99</td>
        <td>N/A</td>
      </tr>
      <tr>
        <td>1</td>
        <td>N/A</td>
      </tr>
      <tr>
        <td>1.01</td>
        <td>N/A</td>
      </tr>
      <tr>
        <td>1.02</td>
        <td>N/A</td>
      </tr>
      <tr>
        <td>1.03</td>
        <td>N/A</td>
      </tr>
      <tr>
        <td>1.04</td>
        <td>N/A</td>
      </tr>
    </table>
  </body>
</html>
